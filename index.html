<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Service Status Monitor</title>
<style>
body {
  background: #0f172a;
  color: white;
  font-family: Arial, sans-serif;
  padding: 40px;
}

h1 {
  margin-bottom: 10px;
}

#countdown {
  margin-bottom: 30px;
  font-size: 18px;
  opacity: 0.8;
}

.service {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #1e293b;
  padding: 15px 20px;
  margin-bottom: 12px;
  border-radius: 12px;
}

.status-box {
  padding: 8px 16px;
  border-radius: 999px;
  font-weight: bold;
  min-width: 140px;
  text-align: center;
}

.operational {
  background: #16a34a;
}

.minor {
  background: #eab308;
  color: black;
}

.major {
  background: #dc2626;
}

.error {
  background: #6b7280;
}
</style>
</head>
<body>

<h1>Global Service Monitor</h1>
<div id="countdown">Refreshing in: 60s</div>

<div id="services"></div>

<script>

const backendURL = "https://site-checker-backend-qmhr.onrender.com";

const services = [
  { key: "discord", label: "Discord", url: "https://discordstatus.com" },
  { key: "cloudflare", label: "Cloudflare", url: "https://www.cloudflarestatus.com" },
  { key: "github", label: "GitHub", url: "https://www.githubstatus.com" },
  { key: "openai", label: "OpenAI", url: "https://status.openai.com" },
  { key: "reddit", label: "Reddit", url: "https://www.redditstatus.com" },
  { key: "twitch", label: "Twitch", url: "https://status.twitch.tv" },
  { key: "aws", label: "Amazon Web Services (AWS)", url: "https://status.aws.amazon.com" },
  { key: "gcloud", label: "Google Cloud", url: "https://status.cloud.google.com" }
];

let countdown = 0;

/* =========================
   SERVICE LIST
========================= */

function createRows(){
const container=document.getElementById("servicesContainer");
container.innerHTML="";

services.forEach(service=>{
container.innerHTML+=`
<div class="service-row">
<div class="service-name"
     onclick="openStatusPage('${service.url}')">
${service.label}
</div>
<div class="status-badge loading" id="status-${service.key}">
Loading...
</div>
</div>`;
});
}

function openStatusPage(url){
window.open(url,"_blank");
}

async function updateAll(){
try{
const res=await fetch(`${backendURL}/api/status`);
const data=await res.json();

countdown = data.nextRefreshIn;

services.forEach(service=>{
const badge=document.getElementById(`status-${service.key}`);
const serviceData=data.services.find(s=>s.key===service.key);

if(!serviceData){
badge.className="status-badge critical";
badge.textContent="Error";
return;
}

let className="operational";
if(serviceData.status==="Minor Issues") className="minor";
if(serviceData.status==="Major Outage") className="major";
if(serviceData.status==="Critical Outage") className="critical";
if(serviceData.status==="Error") className="critical";

badge.className=`status-badge ${className}`;
badge.textContent=serviceData.status;
});

}catch{
console.log("Fetch failed");
}
}

function startCountdown(){
setInterval(()=>{
if(countdown>0){
countdown--;
}
document.querySelector(".subtitle").innerText =
`Live monitoring of major services + manual website lookup. | Refreshing in ${countdown}s`;
},1000);
}

function goBack(){
window.location.href="https://bruesk.github.io";
}

createRows();
updateAll();
startCountdown();
setInterval(updateAll,10000); // poll backend every 10s for countdown sync

</script>

</body>
</html>
